import pyodbc
import win32security
import win32api
import win32con

# Log in as another user
username = 'DOMAIN\\user'
password = 'password'
domain = 'DOMAIN'

handle = win32security.LogonUser(
    username,
    domain,
    password,
    win32con.LOGON32_LOGON_INTERACTIVE,
    win32con.LOGON32_PROVIDER_DEFAULT
)

# Impersonate the user
win32security.ImpersonateLoggedOnUser(handle)

# Connect to the database using pyodbc
conn = pyodbc.connect(
    'DRIVER={SQL Server};SERVER=server_name;DATABASE=database_name;Trusted_Connection=yes;'
)

# Perform database operations
cursor = conn.cursor()
cursor.execute('SELECT * FROM my_table')

# Revert to the original user
win32security.RevertToSelf()
