---
- name: Run Python script as a different domain user on remote Windows host
  hosts: windows
  vars_files:
    - secrets.yml  # This file contains the encrypted password

  tasks:
    - name: Execute Python script as a different domain user using PowerShell
      win_shell: |
        $username = "qa-ent\K032086"
        $password = "{{ ansible_user_password }}" | ConvertTo-SecureString -AsPlainText -Force
        $credential = New-Object System.Management.Automation.PSCredential($username, $password)
        Start-Process -Credential $credential -FilePath "python" -ArgumentList "C:\\path\\to\\script.py"
      args:
        executable: powershell.exe
